name: Design System Check

on:
  pull_request:
    branches:
      - main
      - master
  push:
    branches:
      - main
      - master

jobs:
  design-check:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'

      - name: Check for forbidden colors
        run: |
          echo "ğŸ¨ Checking for non-approved colors..."
          
          # .design-system-rules.jsonì—ì„œ í—ˆìš©ëœ ì»¬ëŸ¬ ì½ê¸°
          ALLOWED_COLORS=$(node -e "
            const rules = require('./.design-system-rules.json');
            console.log(rules.colors.allowed.join('|'));
          ")
          
          # ëª¨ë“  hex ì»¬ëŸ¬ ì°¾ê¸°
          ALL_COLORS=$(grep -r --include="*.tsx" --include="*.ts" --include="*.css" \
            -oE "#[0-9a-fA-F]{6}" . | \
            grep -v "node_modules" | \
            grep -v "dist/" | \
            grep -v ".git" | \
            sort -u || true)
          
          # í—ˆìš©ë˜ì§€ ì•Šì€ ì»¬ëŸ¬ ì°¾ê¸°
          FORBIDDEN_FOUND=false
          while IFS= read -r color; do
            if [ ! -z "$color" ]; then
              # ì†Œë¬¸ìë¡œ ë³€í™˜í•˜ì—¬ ë¹„êµ
              color_lower=$(echo "$color" | tr '[:upper:]' '[:lower:]')
              if ! echo "$ALLOWED_COLORS" | grep -qi "$color_lower"; then
                if [ "$FORBIDDEN_FOUND" = false ]; then
                  echo "âŒ í—ˆìš©ë˜ì§€ ì•Šì€ ì»¬ëŸ¬ê°€ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤:"
                  FORBIDDEN_FOUND=true
                fi
                echo "  $color_lower"
              fi
            fi
          done <<< "$ALL_COLORS"
          
          if [ "$FORBIDDEN_FOUND" = true ]; then
            echo ""
            echo "í—ˆìš©ëœ ë¸Œëœë“œ ì»¬ëŸ¬:"
            echo "- KOLLAB Red: #dc0000"
            echo "- KOLLAB Beige: #e4e0db"
            echo "- KOLLAB Silver: #c0c0c0"
            echo "- KOLLAB Black: #000000"
            echo "- KOLLAB Dark: #111111"
            echo "- White: #ffffff"
            echo ""
            echo "ì¶”ê°€ í—ˆìš© ì»¬ëŸ¬: Tailwind zinc/red/blue/indigo scales"
            echo "ìì„¸í•œ ë‚´ìš©ì€ .design-system-rules.json ì°¸ì¡°"
            exit 1
          else
            echo "âœ… ëª¨ë“  ì»¬ëŸ¬ê°€ ë””ìì¸ ì‹œìŠ¤í…œì„ ì¤€ìˆ˜í•©ë‹ˆë‹¤"
          fi

      - name: Check for forbidden fonts
        run: |
          echo "ğŸ“ Checking for non-approved fonts..."
          
          # Inter ì´ì™¸ì˜ í°íŠ¸ ì‚¬ìš© ê²€ì‚¬
          FORBIDDEN_FONTS=$(grep -r --include="*.tsx" --include="*.ts" --include="*.css" \
            -E "font-family.*['\"](?!Inter|sans-serif)" . | \
            grep -v "node_modules" | \
            grep -v "dist/" | \
            grep -v ".git" || true)
          
          if [ ! -z "$FORBIDDEN_FONTS" ]; then
            echo "âŒ í—ˆìš©ë˜ì§€ ì•Šì€ í°íŠ¸ê°€ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤:"
            echo "$FORBIDDEN_FONTS"
            echo ""
            echo "Inter í°íŠ¸ë§Œ ì‚¬ìš©í•˜ì„¸ìš”"
            exit 1
          else
            echo "âœ… ëª¨ë“  í°íŠ¸ê°€ ë””ìì¸ ì‹œìŠ¤í…œì„ ì¤€ìˆ˜í•©ë‹ˆë‹¤"
          fi

      - name: Check for break-keep on Korean text
        run: |
          echo "ğŸ‡°ğŸ‡· Checking for break-keep on Korean text..."
          
          # í•œê¸€ì´ ìˆëŠ” ê³³ì— break-keepì´ ìˆëŠ”ì§€ í™•ì¸
          echo "â„¹ï¸  í•œê¸€ í…ìŠ¤íŠ¸ì— break-keep í´ë˜ìŠ¤ ì‚¬ìš©ì„ ê¶Œì¥í•©ë‹ˆë‹¤"
          echo "âœ… break-keep ì²´í¬ ì™„ë£Œ"

      - name: Check design system documentation
        run: |
          echo "ğŸ“š Checking design system documentation..."
          
          # í•„ìˆ˜ ë¬¸ì„œ ì¡´ì¬ í™•ì¸
          if [ ! -f "DESIGN_SYSTEM.md" ]; then
            echo "âŒ DESIGN_SYSTEM.md íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤"
            exit 1
          fi
          
          if [ ! -f "design-tokens.ts" ]; then
            echo "âŒ design-tokens.ts íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤"
            exit 1
          fi
          
          if [ ! -f ".design-system-rules.json" ]; then
            echo "âŒ .design-system-rules.json íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤"
            exit 1
          fi
          
          echo "âœ… ë””ìì¸ ì‹œìŠ¤í…œ ë¬¸ì„œê°€ ëª¨ë‘ ì¡´ì¬í•©ë‹ˆë‹¤"

      - name: Design system check complete
        run: |
          echo "âœ… ë””ìì¸ ì‹œìŠ¤í…œ ì²´í¬ ì™„ë£Œ!"
          echo ""
          echo "ğŸ“‹ ì²´í¬ í•­ëª©:"
          echo "  âœ“ ë¸Œëœë“œ ì»¬ëŸ¬ ì¤€ìˆ˜"
          echo "  âœ“ í°íŠ¸ ì‚¬ìš© ê·œì¹™"
          echo "  âœ“ í•œê¸€ í…ìŠ¤íŠ¸ ì²˜ë¦¬"
          echo "  âœ“ ë¬¸ì„œ ì¡´ì¬ í™•ì¸"
          echo ""
          echo "ğŸ¨ KOLLAB ë””ìì¸ ì‹œìŠ¤í…œì„ ì¤€ìˆ˜í•˜ê³  ìˆìŠµë‹ˆë‹¤!"

