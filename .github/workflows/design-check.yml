name: Design System Check

on:
  pull_request:
    branches:
      - main
      - master
  push:
    branches:
      - main
      - master

jobs:
  design-check:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'

      - name: Check for forbidden colors
        run: |
          echo "ğŸ¨ Checking for non-approved colors in component files..."
          
          # ì²´í¬í•  íŒŒì¼ ì°¾ê¸° (design-tokens.ts, .design-system-rules.json ì œì™¸)
          # ì‹¤ì œ ì»´í¬ë„ŒíŠ¸ì™€ ìŠ¤íƒ€ì¼ íŒŒì¼ë§Œ ì²´í¬
          FILES_TO_CHECK=$(find . -type f \
            \( -name "*.tsx" -o -name "*.css" \) \
            ! -path "*/node_modules/*" \
            ! -path "*/dist/*" \
            ! -path "*/.git/*" \
            ! -name "design-tokens.ts" \
            ! -name ".design-system-rules.json")
          
          if [ -z "$FILES_TO_CHECK" ]; then
            echo "âœ… ì²´í¬í•  íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤"
            exit 0
          fi
          
          # í—ˆìš©ëœ ì»¬ëŸ¬ ë¦¬ìŠ¤íŠ¸ (ì •ê·œì‹ íŒ¨í„´ìœ¼ë¡œ)
          ALLOWED_PATTERN="#(dc0000|e4e0db|c0c0c0|000000|111111|ffffff"
          ALLOWED_PATTERN="${ALLOWED_PATTERN}|fafafa|f4f4f5|f5f5f5|e4e4e7|e5e5e5"
          ALLOWED_PATTERN="${ALLOWED_PATTERN}|d4d4d8|d4d4d4|a1a1aa|a3a3a3"
          ALLOWED_PATTERN="${ALLOWED_PATTERN}|71717a|737373|52525b|525252"
          ALLOWED_PATTERN="${ALLOWED_PATTERN}|3f3f46|404040|27272a|1f1f1f"
          ALLOWED_PATTERN="${ALLOWED_PATTERN}|18181b|09090b"
          ALLOWED_PATTERN="${ALLOWED_PATTERN}|fef2f2|fee2e2|fecaca|fca5a5|f87171"
          ALLOWED_PATTERN="${ALLOWED_PATTERN}|ef4444|dc2626|b91c1c|991b1b|7f1d1d|450a0a"
          ALLOWED_PATTERN="${ALLOWED_PATTERN}|1e3a8a|6366f1|3730a3|312e81)"
          
          # í—ˆìš©ë˜ì§€ ì•Šì€ ì»¬ëŸ¬ ì°¾ê¸°
          FORBIDDEN_COLORS=$(echo "$FILES_TO_CHECK" | xargs grep -hioE "#[0-9a-fA-F]{6}" | \
            tr '[:upper:]' '[:lower:]' | \
            sort -u | \
            grep -vE "^${ALLOWED_PATTERN}$" || true)
          
          if [ ! -z "$FORBIDDEN_COLORS" ]; then
            echo "âŒ í—ˆìš©ë˜ì§€ ì•Šì€ ì»¬ëŸ¬ê°€ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤:"
            echo "$FORBIDDEN_COLORS" | while read color; do
              echo "  $color"
              # ì–´ëŠ íŒŒì¼ì—ì„œ ë°œê²¬ë˜ì—ˆëŠ”ì§€ í‘œì‹œ
              echo "$FILES_TO_CHECK" | xargs grep -l "$color" | head -n 3 | while read file; do
                echo "    â†’ $file"
              done
            done
            echo ""
            echo "ğŸ“š í—ˆìš©ëœ ë¸Œëœë“œ ì»¬ëŸ¬:"
            echo "  â€¢ KOLLAB Red: #dc0000"
            echo "  â€¢ KOLLAB Beige: #e4e0db"
            echo "  â€¢ KOLLAB Silver: #c0c0c0"
            echo "  â€¢ KOLLAB Black: #000000"
            echo "  â€¢ KOLLAB Dark: #111111"
            echo "  â€¢ White: #ffffff"
            echo ""
            echo "ğŸ“š ì¶”ê°€ í—ˆìš© ì»¬ëŸ¬:"
            echo "  â€¢ Tailwind zinc scale (50-950)"
            echo "  â€¢ Tailwind red scale (50-950)"
            echo "  â€¢ Blue/Indigo accents"
            echo ""
            echo "â„¹ï¸  design-tokens.tsëŠ” ì²´í¬ ëŒ€ìƒì—ì„œ ì œì™¸ë©ë‹ˆë‹¤"
            exit 1
          else
            echo "âœ… ëª¨ë“  ì»¬ëŸ¬ê°€ ë””ìì¸ ì‹œìŠ¤í…œì„ ì¤€ìˆ˜í•©ë‹ˆë‹¤"
            echo "   ì²´í¬ ì™„ë£Œ: ì»´í¬ë„ŒíŠ¸ (.tsx) ë° ìŠ¤íƒ€ì¼ (.css) íŒŒì¼"
          fi

      - name: Check for forbidden fonts
        run: |
          echo "ğŸ“ Checking for non-approved fonts..."
          
          # Inter ì´ì™¸ì˜ í°íŠ¸ ì‚¬ìš© ê²€ì‚¬
          FORBIDDEN_FONTS=$(grep -r --include="*.tsx" --include="*.ts" --include="*.css" \
            -E "font-family.*['\"](?!Inter|sans-serif)" . | \
            grep -v "node_modules" | \
            grep -v "dist/" | \
            grep -v ".git" || true)
          
          if [ ! -z "$FORBIDDEN_FONTS" ]; then
            echo "âŒ í—ˆìš©ë˜ì§€ ì•Šì€ í°íŠ¸ê°€ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤:"
            echo "$FORBIDDEN_FONTS"
            echo ""
            echo "Inter í°íŠ¸ë§Œ ì‚¬ìš©í•˜ì„¸ìš”"
            exit 1
          else
            echo "âœ… ëª¨ë“  í°íŠ¸ê°€ ë””ìì¸ ì‹œìŠ¤í…œì„ ì¤€ìˆ˜í•©ë‹ˆë‹¤"
          fi

      - name: Check for break-keep on Korean text
        run: |
          echo "ğŸ‡°ğŸ‡· Checking for break-keep on Korean text..."
          
          # í•œê¸€ì´ ìˆëŠ” ê³³ì— break-keepì´ ìˆëŠ”ì§€ í™•ì¸
          echo "â„¹ï¸  í•œê¸€ í…ìŠ¤íŠ¸ì— break-keep í´ë˜ìŠ¤ ì‚¬ìš©ì„ ê¶Œì¥í•©ë‹ˆë‹¤"
          echo "âœ… break-keep ì²´í¬ ì™„ë£Œ"

      - name: Check design system documentation
        run: |
          echo "ğŸ“š Checking design system documentation..."
          
          # í•„ìˆ˜ ë¬¸ì„œ ì¡´ì¬ í™•ì¸
          if [ ! -f "DESIGN_SYSTEM.md" ]; then
            echo "âŒ DESIGN_SYSTEM.md íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤"
            exit 1
          fi
          
          if [ ! -f "design-tokens.ts" ]; then
            echo "âŒ design-tokens.ts íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤"
            exit 1
          fi
          
          if [ ! -f ".design-system-rules.json" ]; then
            echo "âŒ .design-system-rules.json íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤"
            exit 1
          fi
          
          echo "âœ… ë””ìì¸ ì‹œìŠ¤í…œ ë¬¸ì„œê°€ ëª¨ë‘ ì¡´ì¬í•©ë‹ˆë‹¤"

      - name: Design system check complete
        run: |
          echo "âœ… ë””ìì¸ ì‹œìŠ¤í…œ ì²´í¬ ì™„ë£Œ!"
          echo ""
          echo "ğŸ“‹ ì²´í¬ í•­ëª©:"
          echo "  âœ“ ë¸Œëœë“œ ì»¬ëŸ¬ ì¤€ìˆ˜"
          echo "  âœ“ í°íŠ¸ ì‚¬ìš© ê·œì¹™"
          echo "  âœ“ í•œê¸€ í…ìŠ¤íŠ¸ ì²˜ë¦¬"
          echo "  âœ“ ë¬¸ì„œ ì¡´ì¬ í™•ì¸"
          echo ""
          echo "ğŸ¨ KOLLAB ë””ìì¸ ì‹œìŠ¤í…œì„ ì¤€ìˆ˜í•˜ê³  ìˆìŠµë‹ˆë‹¤!"

